---
title: "STAT380 Final Project"
author: "Andrew Eross, Owen Wassel, Jack Messina, Khang Le"
date: "2025-11-20"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Front Matter

```{r}
remove(list = ls())
library(tidyverse)
library(caret)
library(pROC)
library(ggplot2)
library(dplyr)
library(readxl)
library(lubridate)
library(FNN)
library(xgboost)
```

## Read in Datasets

```{r}
CODGameModes <- read.csv("~/Documents/GitHub/stat380finalproject/CODGameModes.csv")
CODGames1 <- read.csv("~/Documents/GitHub/stat380finalproject/CODGames_p1_380.csv")
CODGames2 <- read.csv("~/Documents/GitHub/stat380finalproject/CODGames_p2_380.csv")

```

## Task 1

### Combine Player 1 and Player 2 Data

```{r}
dim(CODGames1)
dim(CODGames2)
head(CODGames1)
```

```{r}
head(CODGameModes)
```

```{r}
# Add a Player ID and stack both datasets

games_all <- bind_rows(
CODGames1 %>% mutate(Player = "Player1"),
CODGames2 %>% mutate(Player = "Player2")
)

dim(games_all)
head(games_all)



```

### Clean GameType (merge HC variants with base modes)

```{r}
# Look at raw GameType values

unique(games_all$GameType)

# Remove "HC -", "HC –", etc. and map hardcore versions to base mode

games_all <- games_all %>%
mutate(
GameType_clean = stringr::str_replace(
GameType,
"HC[[:space:]]*[-–][[:space:]]*",
""
)
)

unique(games_all$GameType_clean)



```

### Join with CODGameModes to bring in ScoreLimit and TimeLimit

```{r}

games_split <- games_all %>%
  # Join with game mode metadata
  left_join(CODGameModes, by = c("GameType_clean" = "Mode")) %>%
  
  # Split Result into team & opponent scores
  separate(Result, into = c("TeamScore", "OpponentScore"), 
           sep = "-", remove = FALSE) %>%
  
  mutate(
    TeamScore = as.numeric(TeamScore),
    OpponentScore = as.numeric(OpponentScore)
  )


```

### Create indicator: did the match reach the score limit?

```{r}

# Create a logical/0-1 variable for reaching the score limit
games_split <- games_split %>%
  mutate(
    ReachedLimit = ifelse(TeamScore == ScoreLimit, 1, 0)
  )


# Sanity check

table(games_split$ReachedLimit, useNA = "ifany")
```

### Summarize: proportion of matches that reach the score limit by game mode

```{r}
limit_summary <- games_split %>%
  group_by(GameType_clean) %>%
  summarise(
    TotalMatches = n(),
    ScoreReached = sum(ReachedLimit, na.rm = TRUE),
    ProportionScoreReached = ScoreReached / TotalMatches
  ) %>%
  rename(GameType = GameType_clean) %>%
  arrange(desc(ProportionScoreReached))

limit_summary



```

### Visualization: bar plot of proportion reaching score limit

```{r}
ggplot(limit_summary,
aes(x = reorder(GameType, ProportionScoreReached),
y = ProportionScoreReached, fill = GameType)) +
geom_text(aes(label = round(ProportionScoreReached, 2)), hjust = -0.1) +
geom_col() +
ylim(0,.6) +
coord_flip() +
labs(
title = "Proportion of Matches Reaching Score Limit by Game Mode",
x = "Game Mode",
y = "Proportion Reaching Score Limit"
) +
theme_minimal()



```

## Task 2

```{r}
# Scale TotalXP based on XPType and remove partial games
scaled_games_split <- games_split %>% 
  mutate(ScaledXP = ifelse(XPType == "10% Boost", TotalXP / 1.1, TotalXP / 2.1)) %>%
  filter(FullPartial == "Full")
```

```{r}
# Select numeric predictors.
numeric_vars <- scaled_games_split %>% select(where(is.numeric), -TotalXP, -ScoreLimit)

# Keep numeric variables with at least 50% non-missing values.
numeric_vars <- numeric_vars[, colMeans(!is.na(numeric_vars)) > 0.50]

# Build modeling dataset containing TotalXP and usable numeric predictors.
model_data <- scaled_games_split %>% select(ScaledXP, all_of(colnames(numeric_vars))) %>% drop_na()
```

```{r}
model_data
```

```{r}
# Remove predictors with near-zero variance.
nzv <- nearZeroVar(model_data, saveMetrics = TRUE)
model_data <- model_data[, !nzv$nzv]
model_data
```

```{r}
# Fit full linear regression model.
full_model <- lm(ScaledXP ~ ., data = model_data)
summary(full_model)
```

```{r}
# Perform AIC-based stepwise model selection.
step_model <- step(full_model, direction = "both", trace = FALSE)
summary(step_model)
```

```{r}
# Extract significant predictors (p < 0.01).
significant_predictors <- summary(step_model)$coefficients
significant_predictors <- significant_predictors[significant_predictors[,4] < 0.01, ]
significant_predictors
```

